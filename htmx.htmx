<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>My HTMX App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/1.5.0/htmx.min.js"></script>
</head>
<body>
    <div id="demo-canvas"><h3>Select Rows And Activate Or Deactivate Below</h3><h3>
        <form id="checked-contacts">
         <table>
           <thead>
           <tr>
             <th></th>
             <th>Name</th>
             <th>Email</th>
             <th>Status</th>
           </tr>
           </thead>
           <tbody id="tbody">
             
<tr class="">
           <td><input type="checkbox" name="ids" value="0"></td><td>Joe Smith</td><td>joe@smith.org</td><td>Active</td>
         </tr>
<tr class="">
           <td><input type="checkbox" name="ids" value="1"></td><td>Angie MacDowell</td><td>angie@macdowell.org</td><td>Active</td>
         </tr>
<tr class="">
           <td><input type="checkbox" name="ids" value="2"></td><td>Fuqua Tarkenton</td><td>fuqua@tarkenton.org</td><td>Active</td>
         </tr>
<tr class="">
           <td><input type="checkbox" name="ids" value="3"></td><td>Kim Yee</td><td>kim@yee.org</td><td>Inactive</td>
         </tr>
           </tbody>
         </table>
       </form>
       <br>
       <br>
       <div hx-include="#checked-contacts" hx-target="#tbody">
         <a class="btn" hx-put="/activate">Activate</a>
         <a class="btn" hx-put="/deactivate">Deactivate</a>
       </div></h3></div>

  <script>

    //=========================================================================
    // Fake Server Side Code
    //=========================================================================

    // data
    var dataStore = function(){
        var data = [
          { name: "Joe Smith", email: "joe@smith.org", status: "Active" },
          { name: "Angie MacDowell", email: "angie@macdowell.org", status: "Active" },
          { name: "Fuqua Tarkenton", email: "fuqua@tarkenton.org", status: "Active" },
          { name: "Kim Yee", email: "kim@yee.org", status: "Inactive" }
        ];
        return {
          findContactById : function(id) {
            return data[id];
          },
          allContacts : function() {
            return data;
          }
        }
      }()
      
      function getIds(params) {
        if(params['ids']) {
          if(Array.isArray(params['ids'])) {
            return params['ids'].map(x => parseInt(x))
          } else {
            return [parseInt(params['ids'])];
          }
        } else {
          return [];
        }
      }
  
      // routes
      init("/demo", function(request){
          return displayUI(dataStore.allContacts());
      });
  
      onPut("/activate", function(request, params){
          var ids = getIds(params);
          for (var i = 0; i < ids.length; i++) {
            dataStore.findContactById(ids[i])['status'] = 'Active';
          }
          return displayTable(ids, dataStore.allContacts(), 'activate');
      });
  
      onPut("/deactivate", function (req, params) {
          var ids = getIds(params);
          for (var i = 0; i < ids.length; i++) {
            dataStore.findContactById(ids[i])['status'] = 'Inactive';
          }
          return displayTable(ids, dataStore.allContacts(), 'deactivate');
      });
  
      // templates
      function displayUI(contacts) {
        return `<h3>Select Rows And Activate Or Deactivate Below<h3>
                 <form id="checked-contacts">
                  <table>
                    <thead>
                    <tr>
                      <th></th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Status</th>
                    </tr>
                    </thead>
                    <tbody id="tbody">
                      ${displayTable([], contacts, "")}
                    </tbody>
                  </table>
                </form>
                <br/>
                <br/>
                <div hx-include="#checked-contacts" hx-target="#tbody">
                  <a class="btn" hx-put="/activate">Activate</a>
                  <a class="btn" hx-put="/deactivate">Deactivate</a>
                </div>`
      }
      
      function displayTable(ids, contacts, action) {
        var txt = "";
        for (var i = 0; i < contacts.length; i++) {
          var c = contacts[i];
          txt += `\n<tr class="${ids.includes(i) ? action : ""}">
                    <td><input type='checkbox' name='ids' value='${i}'></td><td>${c.name}</td><td>${c.email}</td><td>${c.status}</td>
                  </tr>`
        }
        return txt;
      }
  
  </script>
</body>
</html>
